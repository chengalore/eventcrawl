<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Crawler</title>
    <style>
      /* CSS styles for the table */
      table {
        border-collapse: collapse;
        width: 90%; /* Set desired width */
        max-width: 100%;
        border: 1px solid #ddd;
        margin-left: auto;
        margin-right: auto;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        border-top: 1px solid #ddd;
        border: 1px solid rgb(53, 50, 50);
        width: 25%; /* Even width for each column */
      }

      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }

      td {
        font-size: 14px;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      /* Added border in between tables */
      #result {
        margin-top: 20px;
        border-top: 1px solid #ddd;
        padding-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Event Crawler</h1>
    <input type="submit" value="Start" onclick="submit()" />
    <input type="submit" value="Test" onclick="submitTest()" />

    <div id="result">
      <table id="resultTable">
        <thead>
          <tr>
            <th>Store Name</th>
            <th>Source</th>
            <th>External ID</th>
            <th>Is Kid</th>
          </tr>
        </thead>
        <tbody id="resultTableBody"></tbody>
      </table>
    </div>

    <script type="text/javascript">
      let result = [
        {
          storeName: "lumine",
          name: "user-saw-widget-button",
          source: "integration",
          externalUserId: null,
        },
        {
          storeName: "lumine",
          name: "user-saw-product",
          source: "integration",
          externalUserId: null,
        },
        {
          storeName: "lumine",
          name: "user-saw-measurements-view",
          source: "smart-table",
          externalUserId: null,
        },
        {
          storeName: "lumine",
          name: "user-opened-widget",
          source: "inpage",
          externalUserId: null,
        },
      ];
      function submit() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            var resultTableBody = document.getElementById("resultTableBody");
            resultTableBody.innerHTML = generateTableFromResponse(response);
          }
        };
        xhr.open("GET", "http://localhost:3000/start", true);
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded; charset=UTF-8"
        );
        xhr.send();
      }
      function generateTableFromResponse(response) {
        var tableContent = "";

        // Generate table rows
        for (var i = 0; i < response.length; i++) {
          tableContent += "<tr>";
          for (var key in response[i]) {
            tableContent += "<td>" + response[i][key] + "</td>";
          }
          tableContent += "</tr>";
        }

        return tableContent;
      }
      function submitTest() {
        var resultTableBody = document.getElementById("resultTableBody");
        resultTableBody.innerHTML = generateTableFromResponse(result);
      }
    </script>
  </body>
</html>
